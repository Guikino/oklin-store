<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Oklin Store - Compre tênis exclusivos com estilo e conforto." />
  <title>Outlet | Oklin Store</title>

  <!-- Fontes e ícones -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <!-- Seu CSS -->
  <link rel="stylesheet" href="css/outlet.css">
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-container">
      <div class="logo">OKLIN<span>store</span></div>
      <button class="menu-toggle" aria-label="Toggle navigation"><i class="fas fa-bars"></i></button>
      <nav>
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="#lancamentos">Lançamentos</a></li>
          <li><a href="outlet.html">Outlet</a></li>
        </ul>
      </nav>
      <ul class="icons">
        <li><i class="fas fa-search"></i></li>
        <li><a href="criar-conta.html"><i class="fas fa-user"></i></a></li>
        <li>
          <a href="carrinho.html">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count">0</span>
          </a>
        </li>
      </ul>
    </div>
  </header>

  <!-- Seção de Catálogo -->
  <section id="produtos" class="section1">
    <h2>Produtos</h2>
    <div id="lista-produtos" class="prod-container"></div>
  </section>

  <!-- Footer -->
  <footer>
    <p>© 2025 Oklin Store — Todos os direitos reservados</p>
    <ul class="footer-links">
      <li><a href="#">Política de Privacidade</a></li>
      <li><a href="#">Termos de Serviço</a></li>
      <li><a href="#">Contato</a></li>
    </ul>
    <div class="social-icons">
      <a href="#"><i class="fab fa-instagram"></i></a>
      <a href="#"><i class="fab fa-facebook"></i></a>
      <a href="#"><i class="fab fa-twitter"></i></a>
    </div>
  </footer>

  <script>
    // Atualiza contador de itens no carrinho
    function atualizarContadorCarrinho() {
      const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
      const contador = document.querySelector('.cart-count');
      
      if (carrinho.length > 0) {
        contador.textContent = carrinho.length;
        contador.style.display = 'inline-block';
      } else {
        contador.textContent = '0';
        contador.style.display = 'none';
      }
    }

    // Adiciona produto ao carrinho (localStorage)
    function adicionarAoCarrinho(produto) {
      const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
      carrinho.push(produto);
      localStorage.setItem('carrinho', JSON.stringify(carrinho));
      atualizarContadorCarrinho();
      alert(`"${produto.shoeName}" adicionado ao carrinho!`);
    }

    // Busca produtos do backend
    async function buscarProdutos() {
      try {
        const resposta = await fetch('http://localhost:3000/popular');
        if (!resposta.ok) throw new Error('Erro ao buscar produtos');
        const produtos = await resposta.json();
        return produtos;
      } catch (error) {
        console.error(error);
        return [];
      }
    }

    // Gera estrelas para avaliação
    function gerarEstrelas(nota) {
      let estrelas = '';
      for (let i = 0; i < 5; i++) {
        estrelas += `<i class="fas fa-star${i < nota ? '' : '-o'}"></i>`;
      }
      return estrelas;
    }

    // Exibe produtos na tela
    async function exibirProdutos() {
      const produtos = await buscarProdutos();
      const container = document.getElementById('lista-produtos');
      container.innerHTML = '';

      produtos.forEach(produto => {
        const item = document.createElement('div');
        item.className = 'prod';
        item.innerHTML = `
          <img src="${produto.thumbnail}" alt="${produto.shoeName}">
          <div class="descricao">
            <span>${produto.brand || 'Marca desconhecida'}</span>
            <h5>${produto.shoeName}</h5>
            <div class="nota">
              ${gerarEstrelas(5)}
            </div>
            <h4>R$${produto.retailPrice ? produto.retailPrice.toFixed(2) : '---'}</h4>
          </div>
          <a href="#" class="card" aria-label="Adicionar ${produto.shoeName} ao carrinho">
            <span><i class="fas fa-shopping-cart"></i></span>
          </a>
        `;

        item.querySelector('.card').addEventListener('click', e => {
          e.preventDefault();
          adicionarAoCarrinho({
            id: produto.id || null,
            shoeName: produto.shoeName,
            brand: produto.brand || 'Marca desconhecida',
            price: produto.retailPrice || 0,
            thumbnail: produto.thumbnail
          });
        });

        container.appendChild(item);
      });

      atualizarContadorCarrinho();
    }

    // Inicializa
    document.addEventListener('DOMContentLoaded', () => {
      exibirProdutos();

      const menuToggle = document.querySelector('.menu-toggle');
      const navLinks = document.querySelector('.nav-links');
      menuToggle.addEventListener('click', () => {
        navLinks.classList.toggle('active');
      });

      atualizarContadorCarrinho();
    });
  </script>
</body>
</html>
